<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deriv Authorization</title>
</head>
<body>
    <p id="authStatus">Authorizing...</p>

    <script>
        try {
            // Use search (query params), not hash
            const urlParams = new URLSearchParams(window.location.search);
            const token1 = urlParams.get('token1');
            const token2 = urlParams.get('token2');

            const token = token1 || token2; // pick whichever exists
            const authStatusElement = document.getElementById('authStatus');

            if (token) {
                // Send token back to opener (if using popup auth)
                if (window.opener) {
                    window.opener.postMessage({
                        type: 'deriv_auth',
                        token: token
                    }, 'https://tradealgopro.vercel.app');
                }
                
                // Display authorization message after attempting to send token to opener
                authStatusElement.innerHTML = '<strong>Authorization successful!</strong>';

                // Close the window after a short delay to allow the message to be seen
                setTimeout(() => {
                    window.close();
                }, 3000); // Close after 3 seconds
            } else {
                authStatusElement.innerHTML = 'No token found in the URL.';
            }
        } catch (err) {
            console.error('Auth error:', err);
            document.body.innerHTML = '<p>An error occurred during authorization.</p>';
        }
    </script>
</body>
</html>
